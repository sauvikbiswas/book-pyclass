# Method resolution order

In a complex hierarchy, it is difficult to figure out what exactly should a child class inherit from its parent. Let us take a simple example.

    class A(object):
        def speak(self):
            print('Function speak has been inherited from A in object:')
            print(self)
            
    class B(object):
        def speak(self):
            print('Function speak has been inherited from B in object:')
            print(self)
            
    class C(A,B):
        pass
        
    class D(B,A):
        pass
        
    a = A()
    b = B()
    c = C()
    d = D()
    
    a.speak()
    >>> Function speak has been inherited from A in object:
        <__main__.A object at 0x7fd5e89e4190>
        
    b.speak()
    >>> Function speak has been inherited from B in object:
        <__main__.B object at 0x7fd5e89e41d0>

    c.speak()
    >>> Function speak has been inherited from A in object:
        <__main__.C object at 0x7fd5e89e4210>

    d.speak()
    >>> Function speak has been inherited from B in object:
        <__main__.D object at 0x7fd5e89e4250>
        
So far, things are pretty straightforward. The order of inheritence for `class C` is not the same as in `class D`. The priority of the inheritence of `speak` method appears to be that which is passed first in the list of classes during the class declaration. While `class C` resolves to inheriting the `speak` method of `class A`, `class D` inherits the same method from `class B`.

Let us create a situation that will force the method resolution algorithm to get confused. Let us define the following inheritence hierarchy. Here, we let `class B` inherit from `class A`.

    class A(object):
        def speak(self):
            print('Function speak has been inherited from A in object:')
            print(self)
        
    class B(A):
        def speak(self):
            print('Function speak has been inherited from B in object:')
            print(self)

    class C(A, B):
        pass
        
    >>> Traceback (most recent call last):
        File "inherit.py", line 11, in <module>
            class C(A, B):
        TypeError: Error when calling the metaclass bases
            Cannot create a consistent method resolution order (MRO) for bases A, B

Clearly, there is some issue in the resolution. This can be corrected by changing the declation of `class C` to inherit `B` before `A`. Let us rewrite the code.

    class A(object):
        def speak(self):
            print('Function speak has been inherited from A in object:')
            print(self)

    class B(A):
        def speak(self):
            print('Function speak has been inherited from B in object:')
            print(self)

    class C(B, A):
        pass

    a = A()
    b = B()
    c = C()

    a.speak()
    >>> Function speak has been inherited from A in object:
        <__main__.A object at 0x7f5a8d13b190>

    b.speak()
    >>> Function speak has been inherited from B in object:
        <__main__.B object at 0x7f5a8d13b1d0>

    c.speak()
    >>> Function speak has been inherited from B in object:
        <__main__.C object at 0x7f5a8d13b210>

The question is, how did the second declaration correct the error thrown by the first one? In order to answer that question we will have to understand the method resolution order of Python's new-style classes.

# C3 Linearisation

The algorithm used to do so is known as **C3 linearisation**. It is a recursive algorithm and follows the following rules.

1. `L(O) = [O]` where `O` is the base class.
2. `L(A) = [A] + merge(L(A1), L(A2), L(A3), ..., [A1, A2, A3, ..., An])`, where `A` inherits from `A1, A2, A3, ..., An`.
3. `merge(list1, list2, list3, ..., listn) = [K] + merge(list1', list2', list3', ..., listn')`, where `K` is a class occurring in only the first position of any of the lists; `listk'` is `listk` without `K` if `K` was present in `listk`, else `listk'` is same as `listk`.

The merge operation may appear to be confusing but in reality it is not that complicated. The operation can be clarified by the use of a simple example.

